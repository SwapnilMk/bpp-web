import{b as g,cx as O,j as e,dL as I,dC as B}from"./react-vendor-DHXlblm3.js";import{aE as E,aC as k,a4 as p,a$ as b,b2 as T,aD as u}from"./vendor-bQrEs1q3.js";import{p as y}from"./profile.service-CoSnrHDR.js";import{aw as V,x as L,a8 as U,A as R,m as q,n as Y,a9 as o,aa as c,ab as d,a as S,a6 as m,b as C,c as P,d as D,S as l,ac as h,I as j,h as z,B as J,ax as _}from"./index-2NBrDHfX.js";import{E as $}from"./EnhancedDatePicker-BQGi1x2Q.js";import"./tanstack-vendor-CGADoYpr.js";const G=k({profilePicture:u().optional(),title:b(["Mr","Ms","Mrs","Dr","CA","CS","Adv"]).optional(),firstName:u().min(2,{message:"First name must be at least 2 characters."}),middleName:u().optional(),lastName:u().min(2,{message:"Last name must be at least 2 characters."}),dateOfBirth:u().regex(/^\d{4}-\d{2}-\d{2}$/,{message:"Date must be in YYYY-MM-DD format."}),age:T().min(18,{message:"Age must be at least 18."}).max(120),gender:b(["male","female","other"],{required_error:"Please select a gender."})});function H(){const s=V(a=>a.user.user),F=L(),[N,f]=g.useState(!0),v=g.useRef(null),t=O({resolver:E(G),defaultValues:{profilePicture:"",title:void 0,firstName:"",middleName:"",lastName:"",dateOfBirth:"",age:18,gender:"male"},mode:"onChange"});g.useEffect(()=>{var a;s&&t.reset({profilePicture:((a=s.profilePicture)==null?void 0:a.toString())??"",title:s.title,firstName:s.firstName,middleName:s.middleName,lastName:s.lastName,dateOfBirth:s.dateOfBirth,age:s.age,gender:s.gender}),f(!1)},[s,t]);const A=async a=>{var r,x;try{if(f(!0),a.profilePicture!==(s==null?void 0:s.profilePicture)){const i=await y.requestUpdate({updates:{profilePicture:a.profilePicture},type:"NON_SENSITIVE"});i.data.success&&i.data.data&&(F(_({...s,profilePicture:a.profilePicture})),p.success("Profile picture updated successfully"))}const n={title:a.title,firstName:a.firstName,middleName:a.middleName,lastName:a.lastName,dateOfBirth:a.dateOfBirth,age:a.age,gender:a.gender};JSON.stringify(n)!==JSON.stringify({title:s==null?void 0:s.title,firstName:s==null?void 0:s.firstName,middleName:s==null?void 0:s.middleName,lastName:s==null?void 0:s.lastName,dateOfBirth:s==null?void 0:s.dateOfBirth,age:s==null?void 0:s.age,gender:s==null?void 0:s.gender})?(await y.requestUpdate({updates:{personal:n},type:"SENSITIVE"})).data.success&&p.success("Personal details update request sent for approval"):p.info("No changes detected in personal details")}catch(n){const i=n;p.error(((x=(r=i.response)==null?void 0:r.data)==null?void 0:x.message)||"Failed to update personal details")}finally{f(!1)}},w=()=>{var a;(a=v.current)==null||a.click()},M=a=>{var x;const r=(x=a.target.files)==null?void 0:x[0];if(r){const n=new FileReader;n.onloadend=()=>{const i=n.result;t.setValue("profilePicture",i)},n.readAsDataURL(r)}};return e.jsx(e.Fragment,{children:N?e.jsx("div",{className:"text-center text-muted-foreground",children:"Loading personal details..."}):e.jsx(U,{...t,children:e.jsxs("form",{id:"personal-form",onSubmit:t.handleSubmit(A),className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-36 px-6 py-4",style:{background:"radial-gradient(circle, rgba(238, 174, 202, 1) 0%, rgba(148, 187, 233, 1) 100%)"}}),e.jsx("div",{className:"-mt-14 flex justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsxs(R,{className:"h-24 w-24 rounded-full border-4 border-background shadow-lg",children:[e.jsx(q,{src:t.watch("profilePicture")||"https://github.com/shadcn.png",alt:"Profile"}),e.jsx(Y,{children:"U"})]}),e.jsx("button",{onClick:w,className:"absolute bottom-0 right-0 flex h-8 w-8 items-center justify-center rounded-full bg-black/60 text-white hover:bg-black/80","aria-label":"Change profile picture",type:"button",children:e.jsx(I,{size:16})}),e.jsx("input",{type:"file",ref:v,onChange:M,className:"hidden",accept:"image/*"})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Personal Details"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Update your personal information (requires admin approval, can only be updated every 3 months)"})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx(o,{control:t.control,name:"title",render:({field:a})=>e.jsxs(c,{children:[e.jsx(d,{children:"Title"}),e.jsxs(S,{onValueChange:a.onChange,defaultValue:a.value,disabled:!!(s!=null&&s.title),children:[e.jsx(m,{children:e.jsx(C,{children:e.jsx(P,{placeholder:"Select title"})})}),e.jsxs(D,{children:[e.jsx(l,{value:"Mr",children:"Mr"}),e.jsx(l,{value:"Ms",children:"Ms"}),e.jsx(l,{value:"Mrs",children:"Mrs"}),e.jsx(l,{value:"Dr",children:"Dr"}),e.jsx(l,{value:"CA",children:"CA"}),e.jsx(l,{value:"CS",children:"CS"}),e.jsx(l,{value:"Adv",children:"Adv"})]})]}),e.jsx(h,{})]})}),e.jsx(o,{control:t.control,name:"firstName",render:({field:a})=>e.jsxs(c,{children:[e.jsx(d,{children:"First Name"}),e.jsx(m,{children:e.jsx(j,{...a})}),e.jsx(h,{})]})}),e.jsx(o,{control:t.control,name:"middleName",render:({field:a})=>e.jsxs(c,{children:[e.jsx(d,{children:"Middle Name"}),e.jsx(m,{children:e.jsx(j,{...a})}),e.jsx(h,{})]})}),e.jsx(o,{control:t.control,name:"lastName",render:({field:a})=>e.jsxs(c,{children:[e.jsx(d,{children:"Last Name"}),e.jsx(m,{children:e.jsx(j,{...a})}),e.jsx(h,{})]})}),e.jsx(o,{control:t.control,name:"dateOfBirth",render:({field:a})=>e.jsxs(c,{children:[e.jsx(d,{children:"Date of Birth"}),e.jsx(m,{children:e.jsx($,{date:a.value?new Date(a.value):void 0,setDate:r=>{a.onChange(r?r.toISOString().split("T")[0]:"")},minDate:new Date(1900,0,1),maxDate:new Date,className:"w-full"})}),e.jsx(h,{})]})}),e.jsx(o,{control:t.control,name:"age",render:({field:a})=>e.jsxs(c,{children:[e.jsx(d,{children:"Age"}),e.jsx(m,{children:e.jsx(j,{type:"number",...a,onChange:r=>a.onChange(parseInt(r.target.value,10))})}),e.jsx(h,{})]})}),e.jsx(o,{control:t.control,name:"gender",render:({field:a})=>e.jsxs(c,{children:[e.jsx(d,{children:"Gender"}),e.jsxs(S,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(m,{children:e.jsx(C,{children:e.jsx(P,{placeholder:"Select gender"})})}),e.jsxs(D,{children:[e.jsx(l,{value:"male",children:"Male"}),e.jsx(l,{value:"female",children:"Female"}),e.jsx(l,{value:"other",children:"Other"})]})]}),e.jsx(h,{})]})})]})]}),e.jsx(z,{className:"my-6"}),e.jsx("div",{className:"flex justify-end",children:e.jsx(J,{type:"submit",disabled:N,children:"Update personal details"})})]})})})}function K(){return e.jsx("div",{className:"w-full",children:e.jsx(H,{})})}const se=B("/dashboard/profile/")({component:K});export{se as Route};
