import{aK as N,aL as P,r as d,u as W,aM as S,aN as E,aO as O,j as e,aB as D,aC as H,aD as Y,aE as _,I as h,aP as J,t as K,B as f,E as T,i as C,aI as Q,aJ as U,aQ as x,aR as R,y as n,c as G}from"./index-DEOwG95w.js";const j={forgotPassword:async r=>{try{return(await P("/auth/forgot-password",r)).data}catch(o){throw o instanceof Error?new Error(o.message):o}},resetPassword:async r=>{try{return(await P("/auth/reset-password",r)).data}catch(o){throw o instanceof Error?new Error(o.message):o}},logout:async()=>{try{return N.remove("authToken"),N.remove("sessionId"),await P("/auth/logout",{}),{success:!0,message:"Logged out successfully"}}catch(r){throw r instanceof Error?new Error(r.message):r}}},X=O({identifier:x().nonempty("Email or phone number is required").refine(r=>{const o=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,i=/^\d{10}$/;return o.test(r)||i.test(r)},{message:"Please enter a valid email address or 10-digit phone number"})}),ee=O({otp:x().length(4,"OTP must be 4 digits"),newPassword:x().min(1,"Password is required"),confirmPassword:x().min(1,"Confirm Password is required"),showPassword:R().default(!1),showConfirmPassword:R().default(!1)}).refine(r=>r.newPassword===r.confirmPassword,{message:"Passwords do not match",path:["confirmPassword"]}),se=()=>{const[r,o]=d.useState(1),[i,z]=d.useState({type:"",value:""}),[p,w]=d.useState(300),[k,g]=d.useState(!1),[m,c]=d.useState(!1),I=W(),u=S({resolver:E(X),defaultValues:{identifier:""}}),t=S({resolver:E(ee),defaultValues:{otp:"",newPassword:"",confirmPassword:"",showPassword:!1,showConfirmPassword:!1}}),{watch:F}=u,y=F("identifier"),b=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,A=/^\d{10}$/,L=b.test(y),$=A.test(y);d.useEffect(()=>{let a;return r===2&&p>0?a=setInterval(()=>{w(s=>s-1)},1e3):p===0&&g(!0),()=>{a&&clearInterval(a)}},[r,p]);const Z=a=>{const s=Math.floor(a/60),l=a%60;return`${s}:${l.toString().padStart(2,"0")}`},B=async a=>{try{c(!0);const s=a.identifier.trim(),l=b.test(s),q=l?{email:s}:{phone:`+91${s}`},v=await j.forgotPassword(q);if(!v.success){n.error(v.message||"Failed to send OTP");return}z({type:l?"email":"phone",value:s}),o(2),w(300),g(!1),n.success("OTP sent successfully")}catch(s){s instanceof Error?n.error(s.message):n.error("Failed to send OTP. Please try again.")}finally{c(!1)}},M=async()=>{try{c(!0);const a=i.type==="email"?{email:i.value}:{phone:`+91${i.value}`},s=await j.forgotPassword(a);if(!s.success){n.error(s.message||"Failed to resend OTP");return}w(300),g(!1),n.success("OTP resent successfully")}catch(a){a instanceof Error?n.error(a.message):n.error("Failed to resend OTP. Please try again.")}finally{c(!1)}},V=async a=>{try{c(!0);const s={otp:a.otp,newPassword:a.newPassword,[i.type]:i.type==="email"?i.value:`+91${i.value}`},l=await j.resetPassword(s);if(!l.success){n.error(l.message||"Failed to reset password");return}n.success("Password reset successfully"),setTimeout(()=>I({to:"/sign-in"}),3e3)}catch(s){s instanceof Error?n.error(s.message):n.error("Failed to reset password. Please try again.")}finally{c(!1)}};return e.jsx("section",{className:"flex min-h-screen items-start justify-center bg-background px-4 pt-2 sm:items-center sm:p-8 sm:py-6 md:p-10",children:e.jsxs("div",{className:"w-full max-w-xl",children:[e.jsxs(D,{className:"border-0 shadow-none sm:border sm:shadow-md",children:[e.jsx(H,{className:"flex flex-col items-center justify-center px-2 pt-2 sm:px-4 sm:pt-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("img",{src:Y,alt:"BPP Logo",className:"w-[90px] rounded-lg object-contain sm:w-[110px]"}),e.jsx("h2",{className:"font-Inter text-md font-black text-[#2563ec] sm:text-lg",children:"WELCOME TO"}),e.jsx("h2",{className:"font-Inter text-xl font-black text-[#e85a32] sm:text-2xl",children:"BHARATIYA POPULAR PARTY"})]})}),e.jsx(_,{className:"px-2 sm:px-6",children:r===1?e.jsxs("form",{onSubmit:u.handleSubmit(B),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Email/Phone number"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{type:"text",placeholder:"Enter email or phone",autoComplete:"username",...u.register("identifier")}),e.jsxs("div",{className:"pointer-events-none absolute inset-y-0 end-0 flex items-center justify-center pe-3 text-muted-foreground/80 peer-disabled:opacity-50",children:[L&&e.jsx(J,{size:16,strokeWidth:2,"aria-hidden":"true"}),$&&e.jsx(K,{size:16,strokeWidth:2,"aria-hidden":"true"})]})]}),u.formState.errors.identifier&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:u.formState.errors.identifier.message})]}),e.jsx(f,{type:"submit",size:"sm",className:"w-full",disabled:m,children:m?"Sending OTP...":"Send OTP"})]}):e.jsxs("form",{onSubmit:t.handleSubmit(V),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:i.type==="email"?"Email":"Phone"}),e.jsx(h,{value:i.value,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"OTP"}),e.jsx(h,{placeholder:"Enter 4-digit OTP",maxLength:4,type:"text",inputMode:"numeric",...t.register("otp")}),t.formState.errors.otp&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:t.formState.errors.otp.message}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Time remaining: ",Z(p)]}),k&&e.jsx(f,{type:"button",variant:"link",className:"h-auto p-0 text-blue-600",onClick:M,disabled:m,children:"Resend OTP"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{type:t.watch("showPassword")?"text":"password",placeholder:"Enter new password",...t.register("newPassword")}),e.jsx(f,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>t.setValue("showPassword",!t.watch("showPassword")),children:t.watch("showPassword")?e.jsx(T,{size:16}):e.jsx(C,{size:16})})]}),t.formState.errors.newPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:t.formState.errors.newPassword.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{type:t.watch("showConfirmPassword")?"text":"password",placeholder:"Confirm new password",...t.register("confirmPassword")}),e.jsx(f,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>t.setValue("showConfirmPassword",!t.watch("showConfirmPassword")),children:t.watch("showConfirmPassword")?e.jsx(T,{size:16}):e.jsx(C,{size:16})})]}),t.formState.errors.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:t.formState.errors.confirmPassword.message})]})]}),e.jsx(f,{type:"submit",size:"sm",className:"w-full",disabled:m,children:m?"Resetting Password...":"Reset Password"})]})})]}),e.jsxs("div",{className:"mt-3 flex justify-center gap-1 text-sm",children:[e.jsx("p",{children:"Remember your password?"}),e.jsx(Q,{to:"/sign-in",className:"font-semibold underline",children:"Log in"})]}),e.jsx(U,{})]})})},re=G("/(auth)/forgot-password")({component:se});export{re as Route};
