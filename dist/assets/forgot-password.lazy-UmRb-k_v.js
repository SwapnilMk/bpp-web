import{ab as B,r as l,u as M,ap as y,aq as v,ar as E,j as e,ad as W,ae as H,af as Y,ag as _,I as h,as as D,t as U,B as x,E as N,i as S,ak as G,al as J,at as p,au as T,av as C,x as n,aw as K,c as Q}from"./index-Bf-bSf3B.js";const X=E({identifier:p().nonempty("Email or phone number is required").refine(r=>{const d=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,w=/^\d{10}$/;return d.test(r)||w.test(r)},{message:"Please enter a valid email address or 10-digit phone number"})}),ee=E({otp:p().length(4,"OTP must be 4 digits"),newPassword:p().min(1,"Password is required"),confirmPassword:p().min(1,"Confirm Password is required"),showPassword:T().default(!1),showConfirmPassword:T().default(!1)}).refine(r=>r.newPassword===r.confirmPassword,{message:"Passwords do not match",path:["confirmPassword"]}),se=()=>{const r=B(),[d,w]=l.useState(1),[o,R]=l.useState({type:"",value:""}),[f,j]=l.useState(300),[z,P]=l.useState(!1),[c,i]=l.useState(!1),k=M(),m=y({resolver:v(X),defaultValues:{identifier:""}}),s=y({resolver:v(ee),defaultValues:{otp:"",newPassword:"",confirmPassword:"",showPassword:!1,showConfirmPassword:!1}}),{watch:O}=m,g=O("identifier"),b=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,A=/^\d{10}$/,I=b.test(g),F=A.test(g);l.useEffect(()=>{let t;return d===2&&f>0?t=setInterval(()=>{j(a=>a-1)},1e3):f===0&&P(!0),()=>{t&&clearInterval(t)}},[d,f]);const L=t=>{const a=Math.floor(t/60),u=t%60;return`${a}:${u.toString().padStart(2,"0")}`},$=async t=>{try{i(!0);const a=t.identifier.trim(),u=b.test(a),q=u?{email:a}:{phone:`+91${a}`};await r(C(q)).unwrap(),R({type:u?"email":"phone",value:a}),w(2),j(300),P(!1),n.success("OTP sent successfully")}catch(a){a instanceof Error?n.error(a.message):n.error("Failed to send OTP. Please try again.")}finally{i(!1)}},Z=async()=>{try{i(!0);const t=o.type==="email"?{email:o.value}:{phone:`+91${o.value}`};await r(C(t)).unwrap(),j(300),P(!1),n.success("OTP resent successfully")}catch(t){t instanceof Error?n.error(t.message):n.error("Failed to resend OTP. Please try again.")}finally{i(!1)}},V=async t=>{try{i(!0);const a={otp:t.otp,newPassword:t.newPassword,[o.type]:o.type==="email"?o.value:`+91${o.value}`};await r(K(a)).unwrap(),n.success("Password reset successfully"),setTimeout(()=>k({to:"/sign-in"}),3e3)}catch(a){a instanceof Error?n.error(a.message):n.error("Failed to reset password. Please try again.")}finally{i(!1)}};return e.jsx("section",{className:"flex min-h-screen items-start justify-center bg-background px-4 pt-2 sm:items-center sm:p-8 sm:py-6 md:p-10",children:e.jsxs("div",{className:"w-full max-w-xl",children:[e.jsxs(W,{className:"border-0 shadow-none sm:border sm:shadow-md",children:[e.jsx(H,{className:"flex flex-col items-center justify-center px-2 pt-2 sm:px-4 sm:pt-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("img",{src:Y,alt:"BPP Logo",className:"w-[90px] rounded-lg object-contain sm:w-[110px]"}),e.jsx("h2",{className:"font-Inter text-md font-black text-[#2563ec] sm:text-lg",children:"WELCOME TO"}),e.jsx("h2",{className:"font-Inter text-xl font-black text-[#e85a32] sm:text-2xl",children:"BHARATIYA POPULAR PARTY"})]})}),e.jsx(_,{className:"px-2 sm:px-6",children:d===1?e.jsxs("form",{onSubmit:m.handleSubmit($),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Email/Phone number"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{type:"text",placeholder:"Enter email or phone",autoComplete:"username",...m.register("identifier")}),e.jsxs("div",{className:"pointer-events-none absolute inset-y-0 end-0 flex items-center justify-center pe-3 text-muted-foreground/80 peer-disabled:opacity-50",children:[I&&e.jsx(D,{size:16,strokeWidth:2,"aria-hidden":"true"}),F&&e.jsx(U,{size:16,strokeWidth:2,"aria-hidden":"true"})]})]}),m.formState.errors.identifier&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:m.formState.errors.identifier.message})]}),e.jsx(x,{type:"submit",size:"sm",className:"w-full",disabled:c,children:c?"Sending OTP...":"Send OTP"})]}):e.jsxs("form",{onSubmit:s.handleSubmit(V),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:o.type==="email"?"Email":"Phone"}),e.jsx(h,{value:o.value,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"OTP"}),e.jsx(h,{placeholder:"Enter 4-digit OTP",maxLength:4,type:"text",inputMode:"numeric",...s.register("otp")}),s.formState.errors.otp&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:s.formState.errors.otp.message}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Time remaining: ",L(f)]}),z&&e.jsx(x,{type:"button",variant:"link",className:"h-auto p-0 text-blue-600",onClick:Z,disabled:c,children:"Resend OTP"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{type:s.watch("showPassword")?"text":"password",placeholder:"Enter new password",...s.register("newPassword")}),e.jsx(x,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>s.setValue("showPassword",!s.watch("showPassword")),children:s.watch("showPassword")?e.jsx(N,{size:16}):e.jsx(S,{size:16})})]}),s.formState.errors.newPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:s.formState.errors.newPassword.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{type:s.watch("showConfirmPassword")?"text":"password",placeholder:"Confirm new password",...s.register("confirmPassword")}),e.jsx(x,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>s.setValue("showConfirmPassword",!s.watch("showConfirmPassword")),children:s.watch("showConfirmPassword")?e.jsx(N,{size:16}):e.jsx(S,{size:16})})]}),s.formState.errors.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:s.formState.errors.confirmPassword.message})]})]}),e.jsx(x,{type:"submit",size:"sm",className:"w-full",disabled:c,children:c?"Resetting Password...":"Reset Password"})]})})]}),e.jsxs("div",{className:"mt-3 flex justify-center gap-1 text-sm",children:[e.jsx("p",{children:"Remember your password?"}),e.jsx(G,{to:"/sign-in",className:"font-semibold underline",children:"Log in"})]}),e.jsx(J,{})]})})},ae=Q("/(auth)/forgot-password")({component:se});export{ae as Route};
