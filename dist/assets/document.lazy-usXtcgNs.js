import{x as A,r as I,aM as E,aN as J,aO as v,j as e,bk as k,n as x,bl as d,bm as c,bn as i,bo as l,I as S,cC as F,bp as m,B as R,y as h,ct as O,aQ as p,c as q}from"./index-DEOwG95w.js";import{C as w}from"./content-section-tPEaA-AE.js";import{p as U}from"./profile.service-Cwm0Gs2G.js";import{I as u}from"./image-upload-2Dbx1YfU.js";const T=v({aadhaar:v({number:p().regex(/^\d{12}$/,{message:"Aadhaar number must be 12 digits."}).optional(),front:p().optional(),back:p().optional(),updateCount:O().optional()}).optional(),voter:v({number:p().optional(),front:p().optional(),back:p().optional(),updateCount:O().optional()}).optional()});function B(){const{user:o}=A(),[f,j]=I.useState(!0),n=E({resolver:J(T),defaultValues:{aadhaar:(o==null?void 0:o.aadhaar)??void 0,voter:(o==null?void 0:o.voter)??void 0},mode:"onChange"});I.useEffect(()=>{o&&(n.reset({aadhaar:o.aadhaar??void 0,voter:o.voter??void 0}),j(!1))},[o,n]);const V=async a=>{var r,t,y,b,N,C;try{j(!0);const s=o;JSON.stringify(a.aadhaar)!==JSON.stringify(s==null?void 0:s.aadhaar)&&(((r=s==null?void 0:s.aadhaar)==null?void 0:r.updateCount)??0)<2?(await U.requestUpdate({updates:{aadhaar:a.aadhaar},type:"SENSITIVE"})).data.success&&h.success("Aadhaar update request sent for approval"):(((t=s==null?void 0:s.aadhaar)==null?void 0:t.updateCount)??0)>=2&&h.error("Aadhaar details can only be updated twice"),JSON.stringify(a.voter)!==JSON.stringify(s==null?void 0:s.voter)&&(((y=s==null?void 0:s.voter)==null?void 0:y.updateCount)??0)<2?(await U.requestUpdate({updates:{voter:a.voter},type:"SENSITIVE"})).data.success&&h.success("Voter ID update request sent for approval"):(((b=s==null?void 0:s.voter)==null?void 0:b.updateCount)??0)>=2&&h.error("Voter ID details can only be updated twice"),JSON.stringify(a.aadhaar)===JSON.stringify(s==null?void 0:s.aadhaar)&&JSON.stringify(a.voter)===JSON.stringify(s==null?void 0:s.voter)&&h.info("No changes detected in documents")}catch(s){const g=s;h.error(((C=(N=g.response)==null?void 0:N.data)==null?void 0:C.message)||"Failed to update documents")}finally{j(!1)}};return e.jsx(e.Fragment,{children:f?e.jsx("div",{className:"text-center text-muted-foreground",children:"Loading document details..."}):e.jsx(k,{...n,children:e.jsxs("form",{id:"documents-form",onSubmit:n.handleSubmit(V),className:"space-y-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Aadhaar Card"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Update your Aadhaar card details and upload images (max 2 updates allowed)"})]}),e.jsx(x,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{control:n.control,name:"aadhaar.number",render:({field:a})=>{var r,t;return e.jsxs(c,{children:[e.jsx(i,{children:"Aadhaar Number"}),e.jsx(l,{children:e.jsx(S,{...a,disabled:(((r=o==null?void 0:o.aadhaar)==null?void 0:r.updateCount)??0)>=2})}),e.jsxs(F,{children:["Aadhaar changes require admin approval (Update count:"," ",((t=o==null?void 0:o.aadhaar)==null?void 0:t.updateCount)??0,"/2)"]}),e.jsx(m,{})]})}}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(d,{control:n.control,name:"aadhaar.front",render:({field:a})=>e.jsxs(c,{children:[e.jsx(i,{children:"Front Image"}),e.jsx(l,{children:e.jsx(u,{value:a.value,onChange:a.onChange,onRemove:()=>a.onChange("")})}),e.jsx(m,{})]})}),e.jsx(d,{control:n.control,name:"aadhaar.back",render:({field:a})=>e.jsxs(c,{children:[e.jsx(i,{children:"Back Image"}),e.jsx(l,{children:e.jsx(u,{value:a.value,onChange:a.onChange,onRemove:()=>a.onChange("")})}),e.jsx(m,{})]})})]})]})]}),e.jsx(x,{className:"my-6"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Voter ID Card"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Update your Voter ID card details and upload images (max 2 updates allowed)"})]}),e.jsx(x,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{control:n.control,name:"voter.number",render:({field:a})=>{var r,t;return e.jsxs(c,{children:[e.jsx(i,{children:"Voter ID Number"}),e.jsx(l,{children:e.jsx(S,{...a,disabled:(((r=o==null?void 0:o.voter)==null?void 0:r.updateCount)??0)>=2})}),e.jsxs(F,{children:["Voter ID changes require admin approval (Update count:"," ",((t=o==null?void 0:o.voter)==null?void 0:t.updateCount)??0,"/2)"]}),e.jsx(m,{})]})}}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(d,{control:n.control,name:"voter.front",render:({field:a})=>e.jsxs(c,{children:[e.jsx(i,{children:"Front Image"}),e.jsx(l,{children:e.jsx(u,{value:a.value,onChange:a.onChange,onRemove:()=>a.onChange("")})}),e.jsx(m,{})]})}),e.jsx(d,{control:n.control,name:"voter.back",render:({field:a})=>e.jsxs(c,{children:[e.jsx(i,{children:"Back Image"}),e.jsx(l,{children:e.jsx(u,{value:a.value,onChange:a.onChange,onRemove:()=>a.onChange("")})}),e.jsx(m,{})]})})]})]})]}),e.jsx(x,{className:"my-6"}),e.jsx("div",{className:"flex justify-end",children:e.jsx(R,{type:"submit",disabled:f,children:"Update documents"})})]})})})}function L(){return e.jsx(w,{title:"Identity Documents",desc:"Manage your identity documents and verification details.",children:e.jsx(B,{})})}const G=q("/dashboard/profile/document")({component:L});export{G as Route};
