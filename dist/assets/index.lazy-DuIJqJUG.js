import{x as I,r as u,aM as B,aN as k,aO as E,j as e,bk as T,av as V,aw as U,ax as L,bl as d,bm as c,bn as o,d as y,bo as m,e as S,f as P,g as C,S as l,bp as h,I as f,n as R,B as q,y as p,cs as F,ct as Y,aQ as j,c as z}from"./index-DEOwG95w.js";import{p as D}from"./profile.service-Cwm0Gs2G.js";import{I as J,E as _}from"./EnhancedDatePicker-BfN5MHu_.js";const G=E({profilePicture:j().optional(),title:F(["Mr","Ms","Mrs","Dr","CA","CS","Adv"]).optional(),firstName:j().min(2,{message:"First name must be at least 2 characters."}),middleName:j().optional(),lastName:j().min(2,{message:"Last name must be at least 2 characters."}),dateOfBirth:j().regex(/^\d{4}-\d{2}-\d{2}$/,{message:"Date must be in YYYY-MM-DD format."}),age:Y().min(18,{message:"Age must be at least 18."}).max(120),gender:F(["male","female","other"],{required_error:"Please select a gender."})});function Q(){var b;const{user:a,updateUser:O}=I(),[N,g]=u.useState(!0),v=u.useRef(null),t=B({resolver:k(G),defaultValues:{profilePicture:((b=a==null?void 0:a.profilePicture)==null?void 0:b.toString())??"",title:a==null?void 0:a.title,firstName:(a==null?void 0:a.firstName)??"",middleName:(a==null?void 0:a.middleName)??"",lastName:(a==null?void 0:a.lastName)??"",dateOfBirth:(a==null?void 0:a.dateOfBirth)??"",age:(a==null?void 0:a.age)??18,gender:(a==null?void 0:a.gender)??"male"},mode:"onChange"});u.useEffect(()=>{var s;a&&(t.reset({profilePicture:((s=a.profilePicture)==null?void 0:s.toString())??"",title:a.title,firstName:a.firstName,middleName:a.middleName,lastName:a.lastName,dateOfBirth:a.dateOfBirth,age:a.age,gender:a.gender}),g(!1))},[a,t]);const M=async s=>{var r,x;try{if(g(!0),s.profilePicture!==(a==null?void 0:a.profilePicture)){const i=await D.requestUpdate({updates:{profilePicture:s.profilePicture},type:"NON_SENSITIVE"});i.data.success&&i.data.data&&(O({...a,profilePicture:s.profilePicture}),p.success("Profile picture updated successfully"))}const n={title:s.title,firstName:s.firstName,middleName:s.middleName,lastName:s.lastName,dateOfBirth:s.dateOfBirth,age:s.age,gender:s.gender};JSON.stringify(n)!==JSON.stringify({title:a==null?void 0:a.title,firstName:a==null?void 0:a.firstName,middleName:a==null?void 0:a.middleName,lastName:a==null?void 0:a.lastName,dateOfBirth:a==null?void 0:a.dateOfBirth,age:a==null?void 0:a.age,gender:a==null?void 0:a.gender})?(await D.requestUpdate({updates:{personal:n},type:"SENSITIVE"})).data.success&&p.success("Personal details update request sent for approval"):p.info("No changes detected in personal details")}catch(n){const i=n;p.error(((x=(r=i.response)==null?void 0:r.data)==null?void 0:x.message)||"Failed to update personal details")}finally{g(!1)}},w=()=>{var s;(s=v.current)==null||s.click()},A=s=>{var x;const r=(x=s.target.files)==null?void 0:x[0];if(r){const n=new FileReader;n.onloadend=()=>{const i=n.result;t.setValue("profilePicture",i)},n.readAsDataURL(r)}};return e.jsx(e.Fragment,{children:N?e.jsx("div",{className:"text-center text-muted-foreground",children:"Loading personal details..."}):e.jsx(T,{...t,children:e.jsxs("form",{id:"personal-form",onSubmit:t.handleSubmit(M),className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-36 px-6 py-4",style:{background:"radial-gradient(circle, rgba(238, 174, 202, 1) 0%, rgba(148, 187, 233, 1) 100%)"}}),e.jsx("div",{className:"-mt-14 flex justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsxs(V,{className:"h-24 w-24 rounded-full border-4 border-background shadow-lg",children:[e.jsx(U,{src:t.watch("profilePicture")||"https://github.com/shadcn.png",alt:"Profile"}),e.jsx(L,{children:"U"})]}),e.jsx("button",{onClick:w,className:"absolute bottom-0 right-0 flex h-8 w-8 items-center justify-center rounded-full bg-black/60 text-white hover:bg-black/80","aria-label":"Change profile picture",type:"button",children:e.jsx(J,{size:16})}),e.jsx("input",{type:"file",ref:v,onChange:A,className:"hidden",accept:"image/*"})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Personal Details"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Update your personal information (requires admin approval, can only be updated every 3 months)"})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx(d,{control:t.control,name:"title",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Title"}),e.jsxs(y,{onValueChange:s.onChange,defaultValue:s.value,disabled:!!(a!=null&&a.title),children:[e.jsx(m,{children:e.jsx(S,{children:e.jsx(P,{placeholder:"Select title"})})}),e.jsxs(C,{children:[e.jsx(l,{value:"Mr",children:"Mr"}),e.jsx(l,{value:"Ms",children:"Ms"}),e.jsx(l,{value:"Mrs",children:"Mrs"}),e.jsx(l,{value:"Dr",children:"Dr"}),e.jsx(l,{value:"CA",children:"CA"}),e.jsx(l,{value:"CS",children:"CS"}),e.jsx(l,{value:"Adv",children:"Adv"})]})]}),e.jsx(h,{})]})}),e.jsx(d,{control:t.control,name:"firstName",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"First Name"}),e.jsx(m,{children:e.jsx(f,{...s})}),e.jsx(h,{})]})}),e.jsx(d,{control:t.control,name:"middleName",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Middle Name"}),e.jsx(m,{children:e.jsx(f,{...s})}),e.jsx(h,{})]})}),e.jsx(d,{control:t.control,name:"lastName",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Last Name"}),e.jsx(m,{children:e.jsx(f,{...s})}),e.jsx(h,{})]})}),e.jsx(d,{control:t.control,name:"dateOfBirth",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Date of Birth"}),e.jsx(m,{children:e.jsx(_,{date:s.value?new Date(s.value):void 0,setDate:r=>{s.onChange(r?r.toISOString().split("T")[0]:"")},minDate:new Date(1900,0,1),maxDate:new Date,className:"w-full"})}),e.jsx(h,{})]})}),e.jsx(d,{control:t.control,name:"age",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Age"}),e.jsx(m,{children:e.jsx(f,{type:"number",...s,onChange:r=>s.onChange(parseInt(r.target.value,10))})}),e.jsx(h,{})]})}),e.jsx(d,{control:t.control,name:"gender",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Gender"}),e.jsxs(y,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(m,{children:e.jsx(S,{children:e.jsx(P,{placeholder:"Select gender"})})}),e.jsxs(C,{children:[e.jsx(l,{value:"male",children:"Male"}),e.jsx(l,{value:"female",children:"Female"}),e.jsx(l,{value:"other",children:"Other"})]})]}),e.jsx(h,{})]})})]})]}),e.jsx(R,{className:"my-6"}),e.jsx("div",{className:"flex justify-end",children:e.jsx(q,{type:"submit",disabled:N,children:"Update personal details"})})]})})})}function $(){return e.jsx("div",{className:"w-full",children:e.jsx(Q,{})})}const X=z("/dashboard/profile/")({component:$});export{X as Route};
