import{b as h,j as e,cx as N,dC as w}from"./react-vendor-DHXlblm3.js";import{C as R}from"./content-section-BHpIwh8Y.js";import{a4 as d,aE as V,aC as I,aD as P}from"./vendor-bQrEs1q3.js";import{p as b}from"./profile.service-CoSnrHDR.js";import{D as L,e as U,f as q,g as A,a7 as B,I as y,B as O,aw as k,a8 as z,a9 as C,aa as F,ab as S,a6 as T,aE as D,ac as E}from"./index-2NBrDHfX.js";import"./tanstack-vendor-CGADoYpr.js";function H({isOpen:s,onClose:m,type:p,identifier:n,field:u,value:i,onSuccess:v}){const[x,a]=h.useState(""),[c,l]=h.useState(!1),j=async t=>{var r,f;t.preventDefault(),l(!0);try{(await b.verifyOtp({field:u,value:i,otp:x})).data.success&&(d.success("OTP verified successfully"),v(),m())}catch(g){const X=g;d.error(((f=(r=X.response)==null?void 0:r.data)==null?void 0:f.message)||"Failed to verify OTP")}finally{l(!1)}},o=async()=>{var t,r;try{l(!0),(await b.resendOtp(n)).data.success&&d.success("OTP resent successfully")}catch(f){const g=f;d.error(((r=(t=g.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to resend OTP")}finally{l(!1)}};return e.jsx(L,{open:s,onOpenChange:m,children:e.jsxs(U,{children:[e.jsxs(q,{children:[e.jsx(A,{children:"Verify OTP"}),e.jsxs(B,{children:["An OTP has been sent to your ",p,": ",n,". Please enter the OTP below to verify."]})]}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsx(y,{type:"text",placeholder:"Enter OTP",value:x,onChange:t=>a(t.target.value),disabled:c}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(O,{type:"button",variant:"outline",onClick:o,disabled:c,children:"Resend OTP"}),e.jsx(O,{type:"submit",disabled:c,children:"Verify OTP"})]})]})]})})}const M=I({email:P().email({message:"Please enter a valid email."}).optional(),phone:P().regex(/^\+91\d{10}$/,{message:"Phone number must be in the format +91XXXXXXXXXX"})});function Q(){const s=k(a=>a.user.user),[m,p]=h.useState(!1),[n,u]=h.useState(null),i=N({resolver:V(M),defaultValues:{email:"",phone:""},mode:"onChange"});h.useEffect(()=>{s&&i.reset({email:s.email??"",phone:s.phone??""}),p(!1)},[s,i]);const v=()=>{u(null)},x=async a=>{var c,l,j;try{if(p(!0),a.email!==(s==null?void 0:s.email)||a.phone!==(s==null?void 0:s.phone)){const o=a.email!==(s==null?void 0:s.email)?"email":"phone",t=o==="email"?a.email:a.phone;if(t){const r=await b.requestUpdate({updates:{[o]:t},type:"OTP_REQUIRED"});r.data.success&&((c=r.data.data)!=null&&c.requiresOtp)&&u({isOpen:!0,type:o,identifier:t,field:o,value:t,onSuccess:v})}}else d.info("No changes detected")}catch(o){const t=o;d.error(((j=(l=t.response)==null?void 0:l.data)==null?void 0:j.message)||"Failed to initiate update")}finally{p(!1)}};return e.jsxs(e.Fragment,{children:[n&&e.jsx(H,{isOpen:n.isOpen,onClose:()=>u(null),type:n.type,identifier:n.identifier,field:n.field,value:n.value,onSuccess:n.onSuccess}),m?e.jsx("div",{className:"text-center text-muted-foreground",children:"Loading contact details..."}):e.jsx(z,{...i,children:e.jsxs("form",{id:"contact-form",onSubmit:i.handleSubmit(x),className:"space-y-8",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(C,{control:i.control,name:"email",render:({field:a})=>e.jsxs(F,{children:[e.jsx(S,{children:"Email"}),e.jsx(T,{children:e.jsx(y,{type:"email",...a})}),e.jsxs(D,{children:[s!=null&&s.emailVerified?"Email is verified":"Email is not verified",e.jsx("br",{}),"Changing email requires OTP verification and admin approval"]}),e.jsx(E,{})]})}),e.jsx(C,{control:i.control,name:"phone",render:({field:a})=>e.jsxs(F,{children:[e.jsx(S,{children:"Phone Number"}),e.jsx(T,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{value:"+91",disabled:!0,className:"w-16"}),e.jsx(y,{...a})]})}),e.jsxs(D,{children:[s!=null&&s.phoneVerified?"Phone is verified":"Phone is not verified",e.jsx("br",{}),"Changing phone number requires OTP verification and admin approval"]}),e.jsx(E,{})]})})]}),e.jsx(O,{type:"submit",disabled:m,children:"Update contact details"})]})})]})}function _(){return e.jsx(R,{title:"Contact Information",desc:"Update your contact details and communication preferences.",children:e.jsx(Q,{})})}const Z=w("/dashboard/profile/contact")({component:_});export{Z as Route};
