import{b as I,cx as A,j as e,dC as J}from"./react-vendor-DHXlblm3.js";import{C as O}from"./content-section-BHpIwh8Y.js";import{aE as w,aC as v,a4 as d,b2 as S,aD as i}from"./vendor-bQrEs1q3.js";import{p as F}from"./profile.service-CoSnrHDR.js";import{aw as R,a8 as k,h as x,a9 as c,aa as l,ab as m,a6 as p,I as E,aE as U,ac as h,B as q}from"./index-2NBrDHfX.js";import{I as u}from"./image-upload-DcKxkYlO.js";import"./tanstack-vendor-CGADoYpr.js";const T=v({aadhaar:v({number:i().regex(/^\d{12}$/,{message:"Aadhaar number must be 12 digits."}).optional(),front:i().optional(),back:i().optional(),updateCount:S().optional()}).optional(),voter:v({number:i().optional(),front:i().optional(),back:i().optional(),updateCount:S().optional()}).optional()});function B(){const o=R(a=>a.user.user),[f,j]=I.useState(!0),r=A({resolver:w(T),defaultValues:{aadhaar:void 0,voter:void 0},mode:"onChange"});I.useEffect(()=>{o&&r.reset({aadhaar:o.aadhaar??void 0,voter:o.voter??void 0}),j(!1)},[o,r]);const V=async a=>{var n,t,y,C,N,b;try{j(!0);const s=o;JSON.stringify(a.aadhaar)!==JSON.stringify(s==null?void 0:s.aadhaar)&&(((n=s==null?void 0:s.aadhaar)==null?void 0:n.updateCount)??0)<2?(await F.requestUpdate({updates:{aadhaar:a.aadhaar},type:"SENSITIVE"})).data.success&&d.success("Aadhaar update request sent for approval"):(((t=s==null?void 0:s.aadhaar)==null?void 0:t.updateCount)??0)>=2&&d.error("Aadhaar details can only be updated twice"),JSON.stringify(a.voter)!==JSON.stringify(s==null?void 0:s.voter)&&(((y=s==null?void 0:s.voter)==null?void 0:y.updateCount)??0)<2?(await F.requestUpdate({updates:{voter:a.voter},type:"SENSITIVE"})).data.success&&d.success("Voter ID update request sent for approval"):(((C=s==null?void 0:s.voter)==null?void 0:C.updateCount)??0)>=2&&d.error("Voter ID details can only be updated twice"),JSON.stringify(a.aadhaar)===JSON.stringify(s==null?void 0:s.aadhaar)&&JSON.stringify(a.voter)===JSON.stringify(s==null?void 0:s.voter)&&d.info("No changes detected in documents")}catch(s){const g=s;d.error(((b=(N=g.response)==null?void 0:N.data)==null?void 0:b.message)||"Failed to update documents")}finally{j(!1)}};return e.jsx(e.Fragment,{children:f?e.jsx("div",{className:"text-center text-muted-foreground",children:"Loading document details..."}):e.jsx(k,{...r,children:e.jsxs("form",{id:"documents-form",onSubmit:r.handleSubmit(V),className:"space-y-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Aadhaar Card"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Update your Aadhaar card details and upload images (max 2 updates allowed)"})]}),e.jsx(x,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(c,{control:r.control,name:"aadhaar.number",render:({field:a})=>{var n,t;return e.jsxs(l,{children:[e.jsx(m,{children:"Aadhaar Number"}),e.jsx(p,{children:e.jsx(E,{...a,disabled:(((n=o==null?void 0:o.aadhaar)==null?void 0:n.updateCount)??0)>=2})}),e.jsxs(U,{children:["Aadhaar changes require admin approval (Update count:"," ",((t=o==null?void 0:o.aadhaar)==null?void 0:t.updateCount)??0,"/2)"]}),e.jsx(h,{})]})}}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(c,{control:r.control,name:"aadhaar.front",render:({field:a})=>e.jsxs(l,{children:[e.jsx(m,{children:"Front Image"}),e.jsx(p,{children:e.jsx(u,{value:a.value,onChange:a.onChange,onRemove:()=>a.onChange("")})}),e.jsx(h,{})]})}),e.jsx(c,{control:r.control,name:"aadhaar.back",render:({field:a})=>e.jsxs(l,{children:[e.jsx(m,{children:"Back Image"}),e.jsx(p,{children:e.jsx(u,{value:a.value,onChange:a.onChange,onRemove:()=>a.onChange("")})}),e.jsx(h,{})]})})]})]})]}),e.jsx(x,{className:"my-6"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Voter ID Card"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Update your Voter ID card details and upload images (max 2 updates allowed)"})]}),e.jsx(x,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(c,{control:r.control,name:"voter.number",render:({field:a})=>{var n,t;return e.jsxs(l,{children:[e.jsx(m,{children:"Voter ID Number"}),e.jsx(p,{children:e.jsx(E,{...a,disabled:(((n=o==null?void 0:o.voter)==null?void 0:n.updateCount)??0)>=2})}),e.jsxs(U,{children:["Voter ID changes require admin approval (Update count:"," ",((t=o==null?void 0:o.voter)==null?void 0:t.updateCount)??0,"/2)"]}),e.jsx(h,{})]})}}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsx(c,{control:r.control,name:"voter.front",render:({field:a})=>e.jsxs(l,{children:[e.jsx(m,{children:"Front Image"}),e.jsx(p,{children:e.jsx(u,{value:a.value,onChange:a.onChange,onRemove:()=>a.onChange("")})}),e.jsx(h,{})]})}),e.jsx(c,{control:r.control,name:"voter.back",render:({field:a})=>e.jsxs(l,{children:[e.jsx(m,{children:"Back Image"}),e.jsx(p,{children:e.jsx(u,{value:a.value,onChange:a.onChange,onRemove:()=>a.onChange("")})}),e.jsx(h,{})]})})]})]})]}),e.jsx(x,{className:"my-6"}),e.jsx("div",{className:"flex justify-end",children:e.jsx(q,{type:"submit",disabled:f,children:"Update documents"})})]})})})}function L(){return e.jsx(O,{title:"Identity Documents",desc:"Manage your identity documents and verification details.",children:e.jsx(B,{})})}const Q=J("/dashboard/profile/document")({component:L});export{Q as Route};
